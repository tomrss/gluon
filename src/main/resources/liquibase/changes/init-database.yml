databaseChangeLog:
- changeSet:
    id: create-table-role
    author: gluon
    changes:
    - createSequence:
        sequenceName: role_seq
        incrementBy: 50
    - createTable:
        tableName: role
        columns:
        - column:
            name: id
            type: bigint
            valueSequenceNext: role_seq
            constraints:
                nullable: false
                unique: true
                primaryKey: true
                primaryKeyName: role_pk
        - column:
            name: name
            type: varchar(50)
            constraints:
              nullable: false
              unique: true
        - column:
            name: enabled
            type: boolean
            constraints:
              nullable: false
              unique: false
        - column:
            name: assignable_to_user
            type: boolean
            constraints:
              nullable: false
              unique: false
- changeSet:
    id: create-table-user_set
    author: gluon
    changes:
    - createSequence:
        sequenceName: user_set_seq
        incrementBy: 50
    - createTable:
        tableName: user_set
        columns:
        - column:
            name: id
            type: bigint
            valueSequenceNext: user_set_seq
            constraints:
                nullable: false
                unique: true
                primaryKey: true
                primaryKeyName: user_set_pk
        - column:
            name: name
            type: varchar(50)
            constraints:
              nullable: false
              unique: true
        - column:
            name: enabled
            type: boolean
            constraints:
              nullable: false
              unique: false
- changeSet:
    id: create-table-app_user
    author: gluon
    changes:
    - createSequence:
        sequenceName: app_user_seq
        incrementBy: 50
    - createTable:
        tableName: app_user
        columns:
        - column:
            name: id
            type: bigint
            valueSequenceNext: app_user_seq
            constraints:
                nullable: false
                unique: true
                primaryKey: true
                primaryKeyName: app_user_pk
        - column:
            name: name
            type: varchar(50)
            constraints:
              nullable: false
              unique: false
        - column:
            name: email_bla_bla_bla
            type: varchar(100)
            constraints:
              nullable: false
              unique: false
        - column:
            name: description
            type: varchar(255)
        - column:
            name: active
            type: boolean
            constraints:
              nullable: false
              unique: false
        - column:
            name: role_id
            type: bigint
            constraints:
              foreignKeyName: role_fk
              references: role(id)
              nullable: true
              unique: false
    - createIndex:
        columns:
        - column:
           name: name
        - column:
           name: email_bla_bla_bla
        indexName: idx_app_user_1
        tableName: app_user
        unique: true
    - createIndex:
        columns:
        - column:
           name: name
        indexName: idx_app_user_2
        tableName: app_user
        unique: false

- changeSet:
    id: create-join-table-app_user-user_set
    author: gluon
    changes:
    - createSequence:
        # TODO this is ugly:
        sequenceName: app_user_seq_user_set_seq
        incrementBy: 50
    - createTable:
        tableName: app_user_user_set
        columns:
        - column:
            name: app_user_id
            type: bigint
            constraints:
              nullable: false
              unique: false
              # TODO awful
              foreignKeyName: app_user_pk
              references: app_user(id)
        - column:
            name: user_sets_id
            type: bigint
            constraints:
              nullable: false
              unique: false
              foreignKeyName: user_sets_fk
              references: user_set(id)
    - addPrimaryKey:
        tableName: app_user_user_set
        columnNames: app_user_id,user_sets_id
        constraintName: app_user_pk_user_set_pk
